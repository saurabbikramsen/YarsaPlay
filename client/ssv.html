
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Player SSV</title>
</head>
<style>
    input {
        padding: 8px;
        border-radius: 5px;

    }
    button{
        padding: 8px;
        border-radius: 5px;

    }
</style>
<body>
<div style="display:flex;gap: 10px; flex-direction:column;align-items: center; justify-content:center; height:600px;padding: 20px;">
  <h1>Socket Connection</h1>
  <div id="chat">
    <div id="messages"></div>
    <input id="message" placeholder="Type a message..." type="text">
    <button id="send">Send</button>
  </div>
  <div id="room">
    <div id="server_message"></div>
    <input id="roomInput" placeholder="Enter Room Name" type="text">

    <button id="joinRoom">JoinRoom</button>
  </div>
  <div id="message_room">
    <div id="room_messages"></div>
    <input id="roomMessageInput" placeholder="Enter Room message" type="text">

    <button id="sendRoomMessage">SendRoomMessage</button>
  </div>
  <h2>SSE Connection</h2>
  <div id="sseEvents"></div>
</div>
<script crossorigin="anonymous" integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs" src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>

<script type="text/javascript">
  const socket = io('http://localhost:8080',{
    auth: {
      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InNzdkBnbWFpbC5jb20iLCJyb2xlIjoicGxheWVyIiwicmVmcmVzaF9rZXkiOiIydjVnUW0iLCJpYXQiOjE2OTU0ODE1NjQsImV4cCI6MTY5NTQ4ODc2NH0.c-KCOt6uylv9j2tW81Bdly2j2Pid5GHaRehUZThq0Uo"
    }
  });

  const messages = document.getElementById('messages');
  const messageInput = document.getElementById('message');
  const sendButton = document.getElementById('send');

  const server_message = document.getElementById('room_messages');
  const joinRoomButton = document.getElementById('joinRoom');
  const roomName = document.getElementById('roomInput');

  const roomMessages = document.getElementById('room_messages');
  const sendRoomButton = document.getElementById('sendRoomMessage');
  const roomMessageInput = document.getElementById('roomMessageInput');

  const sseMessages = document.getElementById('sseEvents');


  socket.on('connect', function() {
    console.log('Connected');

    sendButton.addEventListener('click', () => {
      const message = messageInput.value;
      if (message) {
        socket.emit('privateMessage', {
          message: message,
          recipientId: 'df9fc093-b06c-4595-8174-44ab479356f5',
        });
        messageInput.value = '';
      }
    });

    joinRoomButton.addEventListener('click', () => {
      const room = roomName.value;
      if (room) {
        socket.emit('join_room', {
          roomName: room,
          userId: '0f983c9b-8cd7-40a1-ac7d-e6ee8d0d9497',
        });
        roomName.value = '';
      }
    });

    sendRoomButton.addEventListener('click', () => {
      const roomMessage = roomMessageInput.value;
      if (roomMessage) {
        socket.emit('message_room', {
          roomName: 'shantiRoom',
          message: roomMessage,
          userId: '0f983c9b-8cd7-40a1-ac7d-e6ee8d0d9497',
        });
        roomMessageInput.value = '';
      }
    });

  })

  socket.on('privateMessage', (message) => {
    const messageElement = document.createElement('div');
    messageElement.innerText = message;
    messages.appendChild(messageElement);
  });

  socket.on('join_room', (message) => {
    const messageElement = document.createElement('div');
    messageElement.innerText = message;
    server_message.appendChild(messageElement);
  });

  socket.on('message_room', (message) => {
    const messageElement = document.createElement('div');
    messageElement.innerText = message;
    roomMessages.appendChild(messageElement);
  });

  const eventSource = new EventSource('http://localhost:8080/sse/event');
  eventSource.onmessage = ( event ) => {
    console.log(event.data);
    const message = document.createElement('div');
    message.innerText = 'New Event: ' + event.data;
    sseMessages.appendChild(message);
  };
</script>
</body>
</html>
